<% LayoutUtils.addMeta({ property:"og:image:url", content: SocialService.getShareUrl() + encodeURI(productImages[0].url) }); %>
<% LayoutUtils.addMeta({ property:"og:image:type", content:"image/png" }); %>
<% LayoutUtils.addMeta({ property:"og:image:width", content:"500" }); %>
<% LayoutUtils.addMeta({ property:"og:image:height", content:"500" }); %>
<% LayoutUtils.addMeta({ property:"og:title", content: product.title }); %>
<% LayoutUtils.addMeta({ property:"og:description", content:"捷陞專業自動門 - 產品介紹" }); %>

<% LayoutUtils.addStylesheets('/assets/jason/page/index/index.css'); %>
<% LayoutUtils.addStylesheets('/assets/jason/page/product/product.css'); %>
<% // LayoutUtils.addStylesheets('/assets/jason/plugins/lightbox/lightbox.min.css'); %>
<% // LayoutUtils.addScripts('/assets/jason/plugins/lightbox/lightbox.min.js'); %>

<div class="container body">

<% include ../../partials/banner.ejs %>

  <div class="row">
    <div class="col-md-9 col-md-push-3 content">

      <article>
        <header class="article-title">
          <h1 id="intro">產品介紹</h2>
        </header>

        <div class="row product-detail">
          <div class="col-md-6 col-md-push-6">
            <h1><%= product.title %></h1>
            <ul class="product-info-list">
              <% if (product.modelName) { %>
                <li>
                  <label>型號</label>
                  <span><%= product.modelName %></span>
                </li>
              <% } %>
              <% if (product.specification) { %>
                <li>
                  <label>規格</label>
                  <span><%= product.specification %></span>
                </li>
              <% } %>
              <% if (product.introduction) { %>
                <li>
                  <label>介紹</label>
                  <span><%= product.introduction %></span>
                </li>
              <% } %>
              <% if (product.Files.length > 0) { %>
                <li class="no-baseline">
                  <a target="_blank" href="<%= product.Files[0].url %>" style="margin-top: 8px;" class="btn btn-primary"><i class="fa fa-floppy-o" style="margin-right: 5px;" aria-hidden="true"></i>檔案下載</a>
                </li>
              <% } %>
            </ul>
          </div>
          <div class="col-md-6 col-md-pull-6 img-content">
            <% if (productImages) { %>
              <div class="post-swiper-container">
                <div class="swiper-wrapper">
                  <% for (image of productImages) { %>
                    <a href="<%= image.url%>" data-lightbox="products" class="swiper-slide">
                      <img src="<%= image.url%>" alt="" />
                      <img style="opacity: 0;" class="watermark" src="/assets/jason/images/watermark.png">
                      <span style="opacity: 0;" class="watermark-text"><%= product.title %></span>
                      <% if (product.modelName) { %>
                        <span style="opacity: 0;" class="watermark-text sub-text"><%= product.modelName %></span>
                      <% } %>
                    </a>
                  <% } %>
                </div>
                <!-- 如果需要分页器 -->
                <!-- <div class="swiper-pagination"></div> -->
              </div>

              <div class="thumbnail-swiper-container">
                <div class="swiper-wrapper">
                  <%
                  for (var i = 0; i < productImages.length; i++) {
                    var image = productImages[i];
                  %>
                    <div class="swiper-slide <%= (i==0)?'active':'' %>" data-idx="<%= i %>">
                      <img src="<%= image.url%>" alt="" />
                      <img style="opacity: 0;" class="watermark" src="/assets/jason/images/watermark.png">
                    </div>
                  <% } %>
                </div>
                <!-- 如果需要分页器 -->
                <!-- <div class="swiper-pagination"></div> -->
                <!-- 如果需要导航按钮 -->
                <!-- <div class="swiper-button-prev"></div>
                <div class="swiper-button-next"></div> -->
              </div>
            <% } %>
          </div>
        </div>

        <% if (product.content) { %>
          <div class="product-intro">
            <h1 class="intro-title">詳細內容介紹</h1>
            <%- product.content %>
          </div>
        <% } %>

        <div class="product-pagination">
          <% if(prevProduct) { %>
            <a class="btn btn-default" href="/product/show/<%= prevProduct.id %>" role="button">上一頁</a>
          <% } else { %>
            <a disabled="disabled" class="btn btn-default" role="button">上一頁</a>
          <% } %>
          <% if(nextProduct) { %>
            <a class="btn btn-default" href="/product/show/<%= nextProduct.id %>" role="button">下一頁</a>
          <% } else { %>
            <a disabled="disabled" class="btn btn-default" role="button">下一頁</a>
          <% } %>
        </div>

      </article>
    </div>

    <div class="col-md-3 col-md-pull-9">
      <div class="side-menu" id="sticker">
        <ul class="list-group">
          <li>
            <h3 class="list-group-item list-group-item-title">
              產品介紹
              <small>Product</small>
            </h3>
          </li>
          <li><a href="/product/group/0/page/1" class="list-group-item">全部產品</a></li>
          <% for(var group of productGroups) { %>
            <li>
              <a href="/product/group/<%= group.id %>/page/1" class="list-group-item"><%= group.title %></a>
            </li>
          <% } %>
        </ul>
      </div>
    </div>
  </div>

  <% include ../../lib/lightbox.ejs %>

  <% include ../../partials/footer.ejs %>

</div>

<% LayoutUtils.addScriptBlock(`
var postSwiper, postThumbSwiper;
jQuery(document).ready(function() {
  postSwiper = new Swiper ('.post-swiper-container', {
    spaceBetween: 3,
    speed: 250,
    grabCursor: true,

    // 如果需要分页器
    // pagination: '.swiper-pagination',
    onSlideChangeStart: function(swiper){
      $('.thumbnail-swiper-container .swiper-slide').removeClass('active');
      $('.thumbnail-swiper-container .swiper-slide:nth-child(' + (swiper.activeIndex+1) + ')').addClass('active');
    },
    onImagesReady: function() {
      watermarkPreprocess();
    }
  })

  postThumbSwiper = new Swiper ('.thumbnail-swiper-container', {
    // loop: true,
    spaceBetween: 15,
    speed: 250,
    slidesPerView: 4,
    // centeredSlides: true,
    paginationClickable: true,

    // 如果需要分页器
    // pagination: '.swiper-pagination',
    // 如果需要前进后退按钮
    // nextButton: '.swiper-button-next',
    // prevButton: '.swiper-button-prev',
  })
  postSwiper.params.control = postThumbSwiper;

  $('.thumbnail-swiper-container .swiper-slide').click(function (){
    postSwiper.slideTo($(this).data('idx'));
  });

  function watermarkPreprocess() {
    $('.watermark').each(function(i, e){
      var w = $(e).closest('.swiper-slide').find('img:not(.watermark)').width();
      var h = $(e).closest('.swiper-slide').find('img:not(.watermark)').height();
      $(e).css({
        width: w,
        height: h,
        opacity: 1,
      })
    });
    $('.watermark-text').each(function(i, e){
      var left = $(e).closest('.swiper-slide').find('img:not(.watermark)').css('margin-left');
      var top = $(e).closest('.swiper-slide').find('img:not(.watermark)').css('margin-top');
      var h = $(e).closest('.swiper-slide').find('img:not(.watermark)').height();
      if ($(e).hasClass('sub-text')) {
        $(e).css({
          top: parseFloat(h) - 85,
          left: 'auto',
          right: parseFloat(left) + 10,
          opacity: 1,
        });
      } else {
        $(e).css({
          top: parseFloat(top) + 38,
          left: parseFloat(left) + 8,
          opacity: 1,
        });
      }
    });
  }

  $( window ).resize(watermarkPreprocess);

});
`); %>
